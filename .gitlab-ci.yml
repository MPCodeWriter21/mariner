image: python:latest

stages:
  - test
  - build
  - release

before_script:
  - apt -y install libxml2-dev libxslt-dev
  - pip install pipenv
  - pip install tox
  - pip install codecov

test:python35:
  stage: test
  image: python:3.5
  script:
    - tox -e py35
  retry: 2

test:python36:
  stage: test
  script:
    - tox -e py36
    - codecov --token=69b7f6f2-c281-4b78-862d-396e8e6f8b1b
  retry: 2

test:linters:
  stage: test
  script: tox -e linters
  allow_failure: true

build:package:
  stage: build
  script: 
    - tox -e build
  artifacts:
    paths:
      - dist
    expire_in: 1 week

release:pypi:
  stage: release
  before_script:
    - pip install twine
  script:
    - twine upload --skip-existing dist/*
  only:
    - tags

pages:
  script:
    - pip install mkdocs
    - pip install mkdocs-cinder
    - mkdocs build -d public/
  artifacts:
    paths:
      - public
  only:
    - master
